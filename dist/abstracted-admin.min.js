!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("abstracted-firebase")):"function"==typeof define&&define.amd?define(["exports","abstracted-firebase"],t):t(e.abstractedAdmin={},e.abstractedFirebase)}(this,function(e,t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t){return e(t={exports:{}},t.exports),t.exports}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e){return(a=Object.getPrototypeOf||function(e){return e.__proto__})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var l=function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}u((i=i.apply(e,t||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});var c=require("firebase-admin"),d=require("process"),h=require("abstracted-firebase");!function(e){e[e.true=1]="true",e[e.false=0]="false"}(e.FirebaseBoolean||(e.FirebaseBoolean={}));var f=function(e){function t(){var e,r,i,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,i=a(t).call(this,n),e=!i||"object"!=typeof i&&"function"!=typeof i?u(r):i,n.mocking||(e.connect(n.debugging),h.RealTimeDB.connection=c.database(),c.database().goOnline(),c.database().ref(".info/connected").on("value",function(r){t.isConnected=r.val(),e._waitingForConnection.forEach(function(e){return e()}),e._waitingForConnection=[],t.isConnected?e._onConnected.forEach(function(t){return t.cb(u(u(e)))}):e._onDisconnected.forEach(function(t){return t.cb(u(u(e)))})})),e}var r,i,n;return r=t,(i=[{key:"waitForConnection",value:function(){return l(this,void 0,void 0,function*(){var e=this;return t.isConnected?Promise.resolve():new Promise(function(t){e._waitingForConnection.push(function(){t()})})})}},{key:"connect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!t.isAuthorized){if(!d.env.FIREBASE_SERVICE_ACCOUNT)throw new Error("Problem loading the credientials for Firebase admin API. Please ensure FIREBASE_SERVICE_ACCOUNT is set with base64 encoded version of Firebase private key.");var r=JSON.parse(Buffer.from(d.env.FIREBASE_SERVICE_ACCOUNT,"base64").toString());console.log("Connecting to Firebase: [".concat(d.env.FIREBASE_DATA_ROOT_URL,"]"));try{c.initializeApp({credential:c.credential.cert(r),databaseURL:d.env.FIREBASE_DATA_ROOT_URL}),t.isAuthorized=!0}catch(e){if(-1===e.message.indexOf("The default Firebase app already exists."))throw t.isConnected=!1,console.warn("Problem connecting to Firebase",e),new Error(e);console.warn("DB was already logged in, however flag had not been set!"),t.isConnected=!0}}e&&c.database.enableLogging("function"==typeof e?function(t){return e(t)}:function(e){return console.log("[FIREBASE]",e)})}},{key:"isConnected",get:function(){return t.isConnected}}])&&o(r.prototype,i),n&&o(r,n),function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");s(e.prototype,t&&t.prototype),t&&s(e,t)}(t,e),t}(h.RealTimeDB);e.DB=f;var y=Object.freeze({}),_=n(function(e,t){var i=r&&r.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}u((i=i.apply(e,t||[])).next())})};function n(e){return e.replace(/\./g,"/")}Object.defineProperty(t,"__esModule",{value:!0}),t.slashNotation=n;class o{constructor(e="/"){this._orderBy="orderByKey",this._path="string"==typeof e?n(e):e}static path(e="/"){return new o(e)}get path(){return this._path}setPath(e){return this._path="string"==typeof e?n(e):e,this}limitToFirst(e){return this._limitToFirst=e,this}limitToLast(e){return this._limitToLast=e,this}orderByChild(e){return this._orderBy="orderByChild",this._orderKey=e,this}orderByValue(){return this._orderBy="orderByValue",this}orderByKey(){return this._orderBy="orderByKey",this}startAt(e,t){return this.validateNoKey("startAt",t),this._startAt=e,this}endAt(e,t){return this.validateNoKey("endAt",t),this._endAt=e,this}equalTo(e,t){return this.validateNoKey("equalTo",t),this._equalTo=e,this}setDB(e){return this.db=e,this}deserialize(e){e||(e=this.db);let t=e.ref("function"==typeof this._path?n(this._path()):this._path);switch(this._orderBy){case"orderByKey":t=t.orderByKey();break;case"orderByValue":t=t.orderByValue();break;case"orderByChild":t=t.orderByChild(this._orderKey)}return this._limitToFirst&&(t=t.limitToFirst(this._limitToFirst)),this._limitToLast&&(t=t.limitToLast(this._limitToLast)),this._startAt&&(t=t.startAt(this._startAt)),this._endAt&&(t=t.endAt(this._endAt)),this._startAt&&(t=t.startAt(this._startAt)),this._equalTo&&(t=t.equalTo(this._equalTo)),t}handleSnapshot(e){return this._handleSnapshot=e,this}execute(){return i(this,void 0,void 0,function*(){const e=yield this.deserialize().once("value");return this._handleSnapshot?this._handleSnapshot(e):e})}where(e,t){switch(e){case"=":return this.equalTo(t);case">":return this.startAt(t);case"<":return this.endAt(t);default:const r=new Error(`Unknown comparison operator: ${e}`);throw r.code="invalid-operator",r}}toJSON(){return JSON.stringify({orderBy:this._orderBy,orderByKey:this._orderKey,limitToFirst:this._limitToFirst,limitToLast:this._limitToLast,startAt:this._startAt,endAt:this._endAt,equalTo:this._equalTo,path:this._path})}toString(){return JSON.stringify({orderBy:this._orderBy,orderByKey:this._orderKey,limitToFirst:this._limitToFirst,limitToLast:this._limitToLast,startAt:this._startAt,endAt:this._endAt,equalTo:this._equalTo,path:this._path},null,2)}validateNoKey(e,t){if(t&&"orderByKey"===this._orderBy)throw new Error(`You can not use the "key" parameter with ${e}() when using the ${this._orderBy} sort.`)}}t.SerializedQuery=o});i(_);_.slashNotation,_.SerializedQuery;var p=n(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.SerializedQuery=_.SerializedQuery,r.default=y.DB;var i=y;r.DB=i.DB,r.FirebaseBoolean=i.FirebaseBoolean,r.RealTimeDB=t.RealTimeDB}),b=i(p),B=p.SerializedQuery,v=p.DB,w=p.FirebaseBoolean,T=p.RealTimeDB;e.default=b,e.SerializedQuery=B,e.DB=v,e.FirebaseBoolean=w,e.RealTimeDB=T,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=abstracted-admin.min.js.map
